<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PBQ Runner — Lesson 15 (Risk Management Processes)</title>

<style>
/* ----------------------------------------------------
   CORE STYLE (SAME AS YOUR TEMPLATE)
---------------------------------------------------- */
:root {
  --bg: #f4f6fa;
  --card: #ffffff;
  --ink: #1b1f2f;
  --ink-dim: #5c6373;
  --accent: #2463eb;
  --ok: #2ba84a;
  --err: #e63946;
  --line: #dfe3eb;
  --muted-bg: #fafbff;
}
* { box-sizing: border-box; }
body {
  margin: 0;
  background: var(--bg);
  color: var(--ink);
  font: 16px/1.5 "Segoe UI", Roboto, system-ui, sans-serif;
}
header {
  padding: 12px;
  background: #fff;
  border-bottom: 1px solid #d7dce6;
  position: sticky;
  top: 0;
  z-index: 20;
}
.pill {
  display: inline-block;
  padding: 0.35rem 0.7rem;
  border-radius: 8px;
  background: #eaf0ff;
  border: 1px solid #c8d4fa;
  color: var(--accent);
  font-weight: 600;
}
main {
  max-width: 900px;
  margin: 32px auto;
  padding: 0 16px;
}
.card {
  background: white;
  border: 1px solid var(--line);
  border-radius: 16px;
  padding: 18px;
  margin: 20px 0;
  box-shadow: 0 4px 16px rgba(0,0,0,0.05);
}
.scenario-label {
  padding: 0.35rem 0.75rem;
  border-radius: 999px;
  background: #e9f9ef;
  border: 1px solid #c6ebd3;
  color: #116a3d;
  font-size: 0.85rem;
  font-weight: 800;
  width: max-content;
}
.chip {
  background:#eef2ff;
  border:1px solid #ccd7ff;
  color:#1f44b4;
  padding:.1rem .45rem;
  border-radius:999px;
  font-size:.75rem;
}
.finding {
  background:#fff;
  border:1px solid var(--line);
  border-radius:12px;
  padding:10px;
  margin:8px 0;
  cursor:grab;
  box-shadow:0 3px 8px rgba(0,0,0,.05);
}
.finding.dragging { opacity:0.7; }

/* ----------------------------------------------------
   PBQ1 HEATMAP (4-QUADRANT)
---------------------------------------------------- */
.heatmap {
  display:grid;
  grid-template-columns: repeat(2, 1fr);
  grid-template-rows: repeat(2, 220px);
  gap:10px;
}
.quad {
  background: var(--muted-bg);
  border:2px dashed #c9d1e3;
  border-radius:14px;
  padding:10px;
  position:relative;
}
.quad h4 {
  margin:0 0 6px;
  color:#1f3a86;
  font-size:1rem;
}
.ghost { opacity:0.4; font-style:italic; }

/* ----------------------------------------------------
   PBQ2 TABLE
---------------------------------------------------- */
table { width:100%; border-collapse:separate; border-spacing:0 }
th, td {
  padding:10px;
  border-bottom:1px solid var(--line);
}
th { background:#eef1ff; }

/* ----------------------------------------------------
   BUTTONS
---------------------------------------------------- */
.btn {
  appearance:none;
  border:1px solid #c2c8d6;
  background:#f8f9fb;
  padding:0.4rem 0.7rem;
  border-radius:8px;
  cursor:pointer;
  font-size:0.9rem;
}
.btn.primary {
  background:var(--accent);
  color:white;
  border-color:var(--accent);
}
.btn:hover { background:#e1e9ff; }
.btn.primary:hover { background:#174bbd; }

.result { margin-top:8px; font-weight:700; }
.correct { color:var(--ok); }
.incorrect { color:var(--err); }

.feedback {
  margin-top:8px;
  padding:10px;
  border-radius:8px;
  background:#fff5f5;
  border:1px solid #f5cccc;
  color:#7a1e27;
}
</style>

</head>
<body>

<header>
  <div class="pill">Lesson 15 • Risk Management Processes</div>
</header>

<main>

<!-- ----------------------------------------------------
     SCENARIO
---------------------------------------------------- -->
<section class="card">
  <div class="scenario-label">Scenario</div>
  <p>
You are completing a quarterly Risk Assessment for KonaTech.  
The goal is to evaluate:
<br><br>
• Likelihood  
• Impact  
• Inherent vs Residual Risk  
• Business Impact Analysis (MTD / MEF importance)  
• Risk Treatment (Mitigate / Transfer / Avoid / Accept)  
• Monitoring cadence  
  </p>
</section>

<!-- ----------------------------------------------------
     PBQ 1: DRAG & DROP 4-QUADRANT HEATMAP
---------------------------------------------------- -->
<section class="card" id="pbq1">
  <div class="scenario-label" style="background:#eaf2ff;color:#1a3db3;">PBQ 1</div>
  <h2>Place each risk in the correct Heatmap Quadrant</h2>
  <p class="muted">Quadrants are based on <b>Likelihood</b> vs <b>Impact</b>
     (Inherent Risk from Lesson 15).</p>

  <div class="heatmap">
    <div class="quad" data-quad="HH">
      <h4>High Likelihood / High Impact</h4>
    </div>
    <div class="quad" data-quad="LH">
      <h4>Low Likelihood / High Impact</h4>
    </div>
    <div class="quad" data-quad="HL">
      <h4>High Likelihood / Low Impact</h4>
    </div>
    <div class="quad" data-quad="LL">
      <h4>Low Likelihood / Low Impact</h4>
    </div>
  </div>

  <div id="risk_pool" style="margin-top:18px;"></div>
  <div class="result" id="pbq1_result"></div>
  <div class="feedback" id="pbq1_fb" hidden></div>
</section>

<!-- ----------------------------------------------------
     PBQ 2: RISK TREATMENT MATRIX
---------------------------------------------------- -->
<section class="card" id="pbq2">
  <div class="scenario-label" style="background:#eaf2ff;color:#1a3db3;">PBQ 2</div>
  <h2>Select the correct Risk Treatment & Monitoring Cadence</h2>

  <table>
    <thead>
      <tr>
        <th>Risk</th>
        <th>Context</th>
        <th>Treatment</th>
        <th>Cadence</th>
      </tr>
    </thead>
    <tbody id="tbody2"></tbody>
  </table>

  <div class="result" id="pbq2_result"></div>
  <div class="feedback" id="pbq2_fb" hidden></div>
</section>

<!-- ----------------------------------------------------
     BUTTONS
---------------------------------------------------- -->
<div style="text-align:center; margin:30px 0;">
  <button class="btn" id="btnReset">Reset</button>
  <button class="btn primary" id="btnCheck">Check Answers</button>
</div>

</main>

<!-- ----------------------------------------------------
     SCRIPT
---------------------------------------------------- -->
<script>
const $ = (s, el=document)=>el.querySelector(s);
const $$ = (s, el=document)=>Array.from(el.querySelectorAll(s));

/* ---------------------------------------------
   PBQ1 — HEATMAP RISKS
--------------------------------------------- */
const RISKS = [
  {
    id:"R1",
    title:"Cloud bucket exposing PII",
    tags:["Confidentiality","Regulatory","MTD Critical"],
    expect:"HH",
    why:"Direct PII exposure → high impact; publicly accessible → high likelihood."
  },
  {
    id:"R2",
    title:"MEF database running outdated cryptography",
    tags:["MEF","Integrity","High Impact"],
    expect:"LH",
    why:"High impact to MEF, but exploit likelihood is still low."
  },
  {
    id:"R3",
    title:"Workstation missing patches (no sensitive data)",
    tags:["Low Impact","Internal"],
    expect:"HL",
    why:"Impact is low but likelihood is moderate/high."
  },
  {
    id:"R4",
    title:"Legacy segmented server not internet-facing",
    tags:["Legacy","Compensating Controls"],
    expect:"LL",
    why:"Segmentation lowers likelihood and business impact is low."
  }
];

let heatmapState = {
  HH:[], LH:[], HL:[], LL:[], POOL:[...RISKS]
};

/* Render cards */
function makeCard(r){
  const d=document.createElement("div");
  d.className="finding";
  d.draggable=true;
  d.dataset.id=r.id;
  d.innerHTML=`
    <div>${r.tags.map(t=>`<span class="chip">${t}</span>`).join(" ")}</div>
    <strong>${r.title}</strong>
  `;
  d.addEventListener("dragstart",e=>{
    d.classList.add("dragging");
    e.dataTransfer.setData("text/plain", r.id);
  });
  d.addEventListener("dragend",()=> d.classList.remove("dragging"));
  return d;
}

function renderPBQ1(){
  /* clear quadrants */
  $$(".quad").forEach(q=> q.querySelectorAll(".finding, .ghost").forEach(e=>e.remove()));

  /* render per quadrant */
  for(const q of ["HH","LH","HL","LL"]){
    const target = document.querySelector(`[data-quad="${q}"]`);
    heatmapState[q].forEach(r=> target.appendChild(makeCard(r)));
    if(heatmapState[q].length===0){
      const ghost=document.createElement("div");
      ghost.textContent="Drag here";
      ghost.className="ghost";
      target.appendChild(ghost);
    }
  }

  /* render pool */
  const pool=$("#risk_pool");
  pool.innerHTML="";
  heatmapState.POOL.forEach(r=> pool.appendChild(makeCard(r)));
}

function moveRisk(target,id){
  for(const q of ["HH","LH","HL","LL","POOL"]){
    const i=heatmapState[q].findIndex(x=>x.id===id);
    if(i>=0){ heatmapState[q].splice(i,1); break; }
  }
  heatmapState[target].push(RISKS.find(r=>r.id===id));
}

function setupDND(){
  const zones=[...$$(".quad"), $("#risk_pool")];
  zones.forEach(z=>{
    z.addEventListener("dragover", e=>{
      e.preventDefault();
      z.style.outline="2px dashed #6c8bff";
    });
    z.addEventListener("dragleave",()=> z.style.outline="none");
    z.addEventListener("drop", e=>{
      e.preventDefault();
      z.style.outline="none";
      const id=e.dataTransfer.getData("text/plain");
      const quad=z.dataset.quad ?? "POOL";
      moveRisk(quad,id);
      renderPBQ1();
    });
  });
}

function gradePBQ1(){
  let correct=0;
  let fb=[];
  for(const q of ["HH","LH","HL","LL"]){
    for(const r of heatmapState[q]){
      if(r.expect===q) correct++;
      else fb.push(`• ${r.title}: should be in ${r.expect}. ${r.why}`);
    }
  }
  $("#pbq1_result").textContent=`${correct}/4 correct`;
  $("#pbq1_result").className="result " + (correct===4 ? "correct" : "incorrect");

  const box=$("#pbq1_fb");
  if(fb.length){
    box.hidden=false;
    box.innerHTML=fb.join("<br>");
  } else {
    box.hidden=true;
    box.innerHTML="";
  }
}

/* ---------------------------------------------
   PBQ2 — RISK TREATMENT TABLE
--------------------------------------------- */
const PBQ2 = [
  {
    risk:"PII Exposure",
    ctx:"Confidentiality breach; high regulatory impact",
    expectT:"Mitigate",
    expectC:"Weekly",
    why:"Immediate remediation + continuous verification."
  },
  {
    risk:"MEF Database Weak Crypto",
    ctx:"High impact to critical function, but low likelihood",
    expectT:"Mitigate",
    expectC:"Bi-weekly",
    why:"Mitigation required, cadence slightly relaxed."
  },
  {
    risk:"Third-Party API Risk",
    ctx:"Shared responsibility with contractual controls",
    expectT:"Transfer",
    expectC:"Monthly",
    why:"Responsibility transferred via SLA."
  },
  {
    risk:"Legacy Segmented Host",
    ctx:"Residual risk within tolerance",
    expectT:"Accept",
    expectC:"Monthly",
    why:"Low impact + compensating controls."
  }
];

const treatments=["Mitigate","Transfer","Accept","Avoid"];
const cadences=["Daily","Weekly","Bi-weekly","Monthly"];

function renderPBQ2(){
  const tbody=$("#tbody2");
  tbody.innerHTML="";
  PBQ2.forEach((r,i)=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td><b>${r.risk}</b></td>
      <td class="muted">${r.ctx}</td>
      <td>
        <select data-i="${i}" data-k="t">
          <option value="" disabled selected>— select —</option>
          ${treatments.map(t=>`<option>${t}</option>`).join("")}
        </select>
      </td>
      <td>
        <select data-i="${i}" data-k="c">
          <option value="" disabled selected>— select —</option>
          ${cadences.map(c=>`<option>${c}</option>`).join("")}
        </select>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

function gradePBQ2(){
  let correct=0;
  const total=PBQ2.length*2;
  let fb=[];

  $$("#tbody2 select").forEach(sel=>{
    const row=PBQ2[sel.dataset.i];
    const v=sel.value;
    if(!v) return;

    if(sel.dataset.k==="t"){
      if(v===row.expectT) correct++;
      else fb.push(`• ${row.risk}: Treatment should be ${row.expectT}. ${row.why}`);
    } else {
      if(v===row.expectC) correct++;
      else fb.push(`• ${row.risk}: Cadence should be ${row.expectC}. ${row.why}`);
    }
  });

  $("#pbq2_result").textContent=`${correct}/${total} correct`;
  $("#pbq2_result").className="result " + (correct===total ? "correct":"incorrect");

  const box=$("#pbq2_fb");
  if(fb.length){
    box.hidden=false;
    box.innerHTML=fb.join("<br>");
  } else {
    box.hidden=true;
    box.textContent="";
  }
}

/* ---------------------------------------------
   Global
--------------------------------------------- */
function resetAll(){
  heatmapState={HH:[],LH:[],HL:[],LL:[],POOL:[...RISKS]};
  renderPBQ1();
  renderPBQ2();
  $("#pbq1_result").textContent="";
  $("#pbq2_result").textContent="";
  $("#pbq1_fb").hidden=true;
  $("#pbq2_fb").hidden=true;
}

function checkAll(){
  gradePBQ1();
  gradePBQ2();
}

/* init */
window.addEventListener("DOMContentLoaded",()=>{
  renderPBQ1();
  renderPBQ2();
  setupDND();
  $("#btnCheck").addEventListener("click", checkAll);
  $("#btnReset").addEventListener("click", resetAll);
});
</script>

</body>
</html>
