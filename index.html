<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>PBQ Runner — Lesson 15 Risk Management</title>

<style>
/* -----------------------------------------------------
   THEME + BASE STYLES
----------------------------------------------------- */
:root {
  --bg: #f4f6fa;
  --card: #ffffff;
  --ink: #1b1f2f;
  --ink-dim: #5c6373;
  --accent: #2463eb;
  --ok: #2ba84a;
  --err: #d62839;
  --line: #dfe3eb;
  --muted-bg: #fafbff;
}

body {
  background: var(--bg);
  margin: 0;
  font-family: "Segoe UI", sans-serif;
  color: var(--ink);
}

header {
  background: white;
  padding: 12px;
  border-bottom: 1px solid var(--line);
  position: sticky;
  top: 0;
  z-index: 50;
}

.pill {
  padding: 6px 12px;
  background: #eaf0ff;
  color: var(--accent);
  font-weight: bold;
  border-radius: 8px;
  display: inline-block;
}

main {
  max-width: 900px;
  margin: 30px auto;
  padding: 0 16px;
}

.card {
  background: white;
  padding: 20px;
  border: 1px solid var(--line);
  border-radius: 14px;
  margin-bottom: 30px;
  box-shadow: 0 4px 12px rgba(0,0,0,.04);
}

.scenario-label {
  font-size: .8rem;
  font-weight: 700;
  background: #e9f9ef;
  border: 1px solid #c6ebd3;
  padding: 4px 10px;
  border-radius: 999px;
  color: #116a3d;
  margin-bottom: 6px;
  display: inline-block;
}

select {
  padding: 6px;
  border-radius: 6px;
  border: 1px solid #cbd2e0;
}

/* -----------------------------------------------------
   PBQ 1: HEATMAP GRID
----------------------------------------------------- */

.heatmap {
  display: grid;
  grid-template-columns: repeat(2,1fr);
  grid-template-rows: repeat(2,200px);
  gap: 10px;
}

.hm-cell {
  background: var(--muted-bg);
  border: 1px dashed #b8c4dd;
  border-radius: 10px;
  padding: 10px;
  position: relative;
}

.hm-cell h4 {
  margin: 0;
  font-size: .9rem;
  color: #1b3f8b;
}

.risk-card {
  background: white;
  border: 1px solid var(--line);
  border-radius: 10px;
  padding: 8px 10px;
  margin: 6px 0;
  cursor: grab;
  box-shadow: 0 3px 8px rgba(0,0,0,.05);
}

.ghost {
  opacity: .4;
  font-style: italic;
  margin-top: 6px;
}

/* -----------------------------------------------------
   PBQ 3 MATCHING
----------------------------------------------------- */
.match-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}

.match-card {
  padding: 10px;
  border: 1px solid var(--line);
  background: white;
  border-radius: 10px;
}

.feedback {
  margin-top: 8px;
  background: #fff5f5;
  color: #a11;
  border: 1px solid #f3c2c2;
  padding: 8px;
  border-radius: 6px;
  display: none;
}

.correct { color: var(--ok); }
.incorrect { color: var(--err); }

.btn {
  background: #eef2ff;
  border: 1px solid #c2c8d6;
  padding: 8px 14px;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
}

.btn.primary {
  background: var(--accent);
  color: white;
  border-color: var(--accent);
}
</style>
</head>

<body>

<header style="display:flex; align-items:center; justify-content:space-between; gap:20px;">
  
  <div class="pill">Lesson 15 • Risk Management</div>

  <div style="display:flex; gap:10px;">
    <button class="btn">Practice Questions</button>
    <button class="btn">Audio Review</button>
    <button class="btn" onclick="resetAll()">Reset</button>
    <button class="btn primary" onclick="gradeAll()">Check Answers</button>
  </div>

</header>

<main>

<!-- -----------------------------------------------------
     SCENARIO
----------------------------------------------------- -->
<section class="card">
  <div class="scenario-label">Scenario</div>
  <p>
    KonaTech is completing its quarterly Risk & Control Self Assessment (RCSA).  
    You must evaluate risks using:
    <br><br>
    • Likelihood × Impact (Heatmap)<br>
    • Risk Treatment options (mitigate / transfer / accept / avoid)<br>
    • Control effectiveness → Inherent vs Residual risk<br><br>

    Complete PBQ 1, PBQ 2, and PBQ 3 below.
  </p>
</section>

<!-- -----------------------------------------------------
     PBQ 1 — HEATMAP DRAG & DROP
----------------------------------------------------- -->
<section class="card" id="pbq1">
  <div class="scenario-label" style="background:#e9f3ff;border-color:#cfe0ff;color:#1b4cb8">PBQ 1</div>
  <h2>Risk Matrix — Drag each risk into the correct quadrant</h2>

  <p class="muted">
    Based on Lesson 15, categorize risks by <b>likelihood</b> and <b>impact</b>.
  </p>

  <div class="heatmap">
    <div class="hm-cell" data-cell="HH">
      <h4>High Likelihood / High Impact</h4>
    </div>

    <div class="hm-cell" data-cell="HL">
      <h4>High Likelihood / Low Impact</h4>
    </div>

    <div class="hm-cell" data-cell="LH">
      <h4>Low Likelihood / High Impact</h4>
    </div>

    <div class="hm-cell" data-cell="LL">
      <h4>Low Likelihood / Low Impact</h4>
    </div>
  </div>

  <div id="pool_pbq1" style="margin-top:20px;"></div>

  <div id="pbq1_result" class="result"></div>
  <div id="pbq1_fb" class="feedback"></div>
</section>

<!-- -----------------------------------------------------
     PBQ 2 — RISK TREATMENT TABLE
----------------------------------------------------- -->
<section class="card" id="pbq2">
  <div class="scenario-label" style="background:#e9f3ff;border-color:#cfe0ff;color:#1b4cb8">PBQ 2</div>
  <h2>Select Treatment & Verification Cadence</h2>

  <p class="muted">
    Choose the correct <b>risk response</b> & <b>monitoring frequency</b>.
  </p>

  <table style="width:100%; border-collapse:separate; border-spacing:0;">
    <thead>
      <tr>
        <th>Asset</th>
        <th>Context</th>
        <th>Treatment</th>
        <th>Cadence</th>
      </tr>
    </thead>
    <tbody id="pbq2_body"></tbody>
  </table>

  <div id="pbq2_result" class="result"></div>
  <div id="pbq2_fb" class="feedback"></div>
</section>

<!-- -----------------------------------------------------
     PBQ 3 — MATCHING (INHERENT VS RESIDUAL RISK)
----------------------------------------------------- -->
<section class="card" id="pbq3">
  <div class="scenario-label" style="background:#e9f3ff;border-color:#cfe0ff;color:#1b4cb8">PBQ 3</div>
  <h2>Match the Correct Risk Concepts</h2>

  <p class="muted">
    Match threat, vulnerability, control, inherent risk, and residual risk.
  </p>

  <!-- MATCHING GRID FIXED LAYOUT -->
  <div style="display:grid; grid-template-columns: 1fr auto; gap:16px; align-items:start;">

    <div>
      <div class="match-card"><b>Threat:</b> Phishing campaigns targeting finance</div>
      <div class="match-card"><b>Vulnerability:</b> Users lack MFA</div>
      <div class="match-card"><b>Control:</b> Add MFA + anti-phishing training</div>
    </div>

    <div style="display:flex; flex-direction:column; gap:12px;">

      <select class="match-select" data-key="inherent">
        <option disabled selected>— inherent risk —</option>
        <option>High (no controls in place)</option>
        <option>Medium (controls partially effective)</option>
        <option>Low (controls strong)</option>
      </select>

      <select class="match-select" data-key="residual">
        <option disabled selected>— residual risk —</option>
        <option>High (risk unchanged)</option>
        <option>Medium (risk reduced)</option>
        <option>Low (risk minimized)</option>
      </select>

    </div>

  </div>

  <div id="pbq3_result" class="result"></div>
  <div id="pbq3_fb" class="feedback"></div>
</section>

<!-- -----------------------------------------------------
     GLOBAL BUTTONS
----------------------------------------------------- -->
<div style="text-align:center; margin:40px 0;">
  <button class="btn primary" onclick="gradeAll()">Check All</button>
  <button class="btn" onclick="resetAll()">Reset</button>
</div>

</main>

<script>
/* -----------------------------------------------------
   PBQ 1 — Heatmap Drag/Drop
----------------------------------------------------- */

const PBQ1_RISKS = [
  { id:"r1", text:"Public-facing database w/ exposed PII", expect:"HH" },
  { id:"r2", text:"Weak passwords on internal HR system", expect:"HL" },
  { id:"r3", text:"Critical MEF dependency with rare outage risk", expect:"LH" },
  { id:"r4", text:"Legacy printer server not externally reachable", expect:"LL" }
];

function renderPBQ1(){
  const pool = document.getElementById("pool_pbq1");
  pool.innerHTML = "";
  PBQ1_RISKS.forEach(r=>{
    const div = document.createElement("div");
    div.className = "risk-card";
    div.draggable = true;
    div.dataset.id = r.id;
    div.innerText = r.text;

    div.addEventListener("dragstart", e=>{
      e.dataTransfer.setData("text/plain", r.id);
    });

    pool.appendChild(div);
  });

  document.querySelectorAll(".hm-cell").forEach(cell=>{
    cell.addEventListener("dragover", e=> e.preventDefault());
    cell.addEventListener("drop", e=>{
      const id = e.dataTransfer.getData("text/plain");
      const card = document.querySelector(`[data-id='${id}']`);
      cell.appendChild(card);
    });
  });
}

function gradePBQ1(){
  let correct = 0;
  let fb = [];

  PBQ1_RISKS.forEach(r=>{
    const cell = document.querySelector(`.hm-cell[data-cell='${r.expect}']`);
    const cardInCell = cell.querySelector(`[data-id='${r.id}']`);

    if(cardInCell) correct++;
    else fb.push(`• ${r.text} should be in ${r.expect}`);
  });

  document.getElementById("pbq1_result").innerHTML =
    `${correct}/${PBQ1_RISKS.length} correct`;

  const f = document.getElementById("pbq1_fb");
  if(fb.length){
    f.style.display="block";
    f.innerHTML = fb.join("<br>");
  } else {
    f.style.display="none";
  }
}

/* -----------------------------------------------------
   PBQ 2 — Treatment Table
----------------------------------------------------- */

const PBQ2_ITEMS = [
  {
    name:"Finance Database",
    ctx:"High confidentiality • MEF system",
    expectT:"Mitigate",
    expectC:"Weekly"
  },
  {
    name:"Public Marketing Website",
    ctx:"Low confidentiality • Informational only",
    expectT:"Accept",
    expectC:"Monthly"
  },
  {
    name:"3rd-Party Payroll Portal",
    ctx:"Contractual SLA • Shared responsibility",
    expectT:"Transfer",
    expectC:"Monthly"
  },
  {
    name:"Legacy Backup Appliance",
    ctx:"Compensating controls • Being replaced",
    expectT:"Accept",
    expectC:"Bi-Weekly"
  }
];

function renderPBQ2(){
  const tbody = document.getElementById("pbq2_body");
  tbody.innerHTML = "";

  PBQ2_ITEMS.forEach((item,i)=>{
    const tr = document.createElement("tr");

    tr.innerHTML = `
      <td><b>${item.name}</b></td>
      <td>${item.ctx}</td>
      <td>
        <select data-row="${i}" data-type="T">
          <option disabled selected>— choose —</option>
          <option>Mitigate</option>
          <option>Transfer</option>
          <option>Accept</option>
          <option>Avoid</option>
        </select>
      </td>
      <td>
        <select data-row="${i}" data-type="C">
          <option disabled selected>— choose —</option>
          <option>Daily</option>
          <option>Weekly</option>
          <option>Bi-Weekly</option>
          <option>Monthly</option>
        </select>
      </td>
    `;

    tbody.appendChild(tr);
  });
}

function gradePBQ2(){
  let correct = 0;
  let fb = [];

  document.querySelectorAll("#pbq2_body select").forEach(sel=>{
    const row = sel.dataset.row;
    const type = sel.dataset.type;
    const val = sel.value;

    if(!val) return;

    const exp = type === "T"
      ? PBQ2_ITEMS[row].expectT
      : PBQ2_ITEMS[row].expectC;

    if(val === exp){
      correct++;
    } else {
      fb.push(`• ${PBQ2_ITEMS[row].name}: should be ${exp}`);
    }
  });

  document.getElementById("pbq2_result").innerHTML =
    `${correct}/${PBQ2_ITEMS.length*2} correct`;

  const f = document.getElementById("pbq2_fb");
  if(fb.length){
    f.style.display="block";
    f.innerHTML = fb.join("<br>");
  } else {
    f.style.display="none";
  }
}

/* -----------------------------------------------------
   PBQ 3 — Matching
----------------------------------------------------- */

function gradePBQ3(){
  const selInherent = document.querySelector("[data-key='inherent']").value;
  const selResidual = document.querySelector("[data-key='residual']").value;

  let correct = 0;
  let fb = [];

  if(selInherent === "High (no controls in place)") correct++;
  else fb.push("• Inherent risk should be HIGH");

  if(selResidual === "Medium (risk reduced)") correct++;
  else fb.push("• Residual risk should be MEDIUM");

  document.getElementById("pbq3_result").innerHTML = `${correct}/2 correct`;

  const f = document.getElementById("pbq3_fb");
  if(fb.length){
    f.style.display="block";
    f.innerHTML = fb.join("<br>");
  } else f.style.display="none";
}

/* -----------------------------------------------------
   GLOBAL
----------------------------------------------------- */

function gradeAll(){
  gradePBQ1();
  gradePBQ2();
  gradePBQ3();
}

function resetAll(){
  renderPBQ1();
  renderPBQ2();
  document.getElementById("pbq1_result").innerHTML="";
  document.getElementById("pbq1_fb").style.display="none";
  document.getElementById("pbq2_result").innerHTML="";
  document.getElementById("pbq2_fb").style.display="none";
  document.getElementById("pbq3_result").innerHTML="";
  document.getElementById("pbq3_fb").style.display="none";
}

/* INIT */
renderPBQ1();
renderPBQ2();

</script>

</body>
</html>
